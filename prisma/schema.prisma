generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public"]
}

model applications {
  id                String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at        DateTime @default(now()) @db.Timestamptz(6)
  updated_at        DateTime @default(now()) @db.Timestamptz(6)
  full_name         String
  mobile_number     String
  email             String?
  
  // --- Updated Address Fields ---
  address_line_1    String?
  address_line_2    String?
  city              String?
  state             String?
  pincode           String?
  // -----------------------------

  product_category  String
  product_type      String
  application_stage String   @default("started")
  status            String   @default("new")
  source            String   @default("website")
  metadata          Json?    @default("{}")
  ip                String?  @db.VarChar(64)
  user_agent        String?  @db.VarChar(512)
  
  // Relations (if any)
  assigned_to       String?  @db.Uuid

  @@schema("public")
}

model contact_messages {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  full_name     String
  email         String
  mobile_number String
  city          String?
  state         String?
  ip            String?  @db.VarChar(64)
  user_agent    String?  @db.VarChar(512)
  message       String
  subject       String?
  reason        String?
  status        String?  @default("new")

  @@schema("public")
}

model profiles {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String    @unique @db.Uuid
  full_name  String?
  email      String?
  phone      String?
  address    String?
  photo_url  String?
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  role       user_role @default(user)

  @@index([user_id], map: "idx_profiles_user_id")
  @@schema("public")
}

model role_change_audit {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  actor_user_id  String   @db.Uuid
  target_user_id String   @db.Uuid
  old_role       user_role
  new_role       user_role
  created_at     DateTime @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

model application_assignments {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  application_id  String   @db.Uuid
  agent_user_id   String   @db.Uuid
  assigned_by     String   @db.Uuid // admin
  assigned_at     DateTime @default(now()) @db.Timestamptz(6)
  is_active       Boolean  @default(true)

  @@index([application_id])
  @@index([agent_user_id])
  @@schema("public")
}

model application_remarks {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  application_id  String   @db.Uuid
  agent_user_id   String   @db.Uuid
  remark          String
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  metadata        Json?

  @@index([application_id])
  @@index([agent_user_id])
  @@schema("public")
}

enum user_role {
  user
  agent
  admin

  @@schema("public")
}